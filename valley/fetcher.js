const map=L.map("map").setView([12.91,77.57],12),tiles=L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);var geoJSON,renderedCheckboxes=!1,checkedSet=new Set;function renderCheckboxes(){var e,t=0,n=document.getElementById("checkboxContainer"),o=document.createElement("table");for(const[n,a]of Object.entries(geoJSON)){t%4==0&&(e=document.createElement("tr")),o.appendChild(e);const a=document.createElement("td");var r=document.createElement("input");r.type="checkbox",r.id=r.name=n,r.checked=!0,checkedSet.add(n),r.addEventListener("change",function(){this.checked?checkedSet.add(this.id):checkedSet.delete(this.id),refreshBusLayers(geoJSON)});var c=document.createElement("label");c.htmlFor=n,c.appendChild(document.createTextNode(n)),a.appendChild(r),a.appendChild(c),e.appendChild(a),t++}n.appendChild(o)}function refreshBusLayers(){map.eachLayer(function(e){e.feature&&map.removeLayer(e)});for(const[e,t]of Object.entries(geoJSON))if(console.log(e,t,checkedSet.has(e)),checkedSet.has(e))L.geoJSON(t,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:e.properties.icon,iconAnchor:[15,18],popupAnchor:[0,0]})})},onEachFeature:function(e,t){let n="Unknown";e.properties&&e.properties.popupContent&&(n=e.properties.popupContent),t.bindPopup(n)}}).addTo(map)}function refreshMap(){fetch("https://api.santoshrao.com/valley-bus").then(function(e){return e.json()}).then(function(e){geoJSON=e,renderedCheckboxes||(renderCheckboxes(geoJSON),renderedCheckboxes=!0),refreshBusLayers(geoJSON)}).catch(function(e){console.error("Error fetching data:",e)})}refreshMap(),setInterval(refreshMap,3e4);
